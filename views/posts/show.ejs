<%- include('../partials/html-head') %>
<link rel="stylesheet" href="/stylesheets/posts/show.css">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<script defer src="/javascripts/javascript.js"></script>
<%- include('../partials/nav') %>

<h1><%= title %></h1>
<main>
  <div class="post-container">
    <div class="post-card">
      <div class="author">
        <h4><img id="avatar" src="<%= post.author.avatar %>" alt="user profile image"><%= post.author.name %></h4>
        <img id="post-photo" src="<%= post.photo %>" alt="A picture of a sweet pet">
        <br>
        <textarea><%= post.description %></textarea>
      </div>
      <div class="post-stats">
        <h6><%= post.date.toLocaleString('en-US', {weekday: 'long', month: 'short', day: 'numeric', year: 'numeric', hour: 'numeric', minute: 'numeric'}) %></h6>
        <div class="button-container">
          <% if (post.author._id.equals(user.profile._id)) { %>
            <form action="/posts/<%= post._id %>?_method=DELETE" method="POST">
              <button class="delete-button">Delete 🗑️</button>
            </form>
            <a href="/posts/<%= post._id %>/edit">
              <button class="edit-button">Edit ✎</button>
            </a>
          <% } %>
        </div>
      </div>
      <form method="POST" action="/posts/<%= post._id %>/comments">
        <textarea type="text" name="content" cols="20" rows="2" placeholder="Show some love ..."></textarea>
        <button type="submit" class="comment-button">Add Comment</button>
      </form>
      <% if (post.comments.length) { %>
        <h4>Comments</h4>
        <ul>
          <% post.comments.forEach(comment => { %>
            <li>
              <%= comment.content %> - 
              <img 
                class="avatar" 
                src="<%= comment.author.avatar %>" 
                alt="comment author avatar"
              >
              <%= comment.author.name %> 
              <% if (comment.author._id.equals(user.profile._id)) { %>
                <form action="/posts/<%= post._id %>/comments/<%= comment._id %>?_method=DELETE" method="POST">
                  <button type="submit">🗑️</button>
                </form> 
              <% } %>
            </li>
          <% }) %>
        </ul>
      <% } else { %>
        <h4>No comments yet 🤍</h4>
      <% } %>
    </div>
  </div>
</main>
<%- include('../partials/footer') %>
